# å®šæª¢è¡¨æ¨¡æ¿ç³»çµ±æŠ€è¡“è¦æ ¼

> **å°ˆæ¡ˆ**: InduSpect AI - æ™ºæ…§å·¡æª¢ç³»çµ±
> **ç‰ˆæœ¬**: v2.0 è¦æ ¼æ›¸
> **å»ºç«‹æ—¥æœŸ**: 2025-11-04
> **è² è²¬åœ˜éšŠ**: doflab åŠ‰ç‘å¼˜è€å¸«ç ”ç©¶åœ˜éšŠ

---

## ğŸ¯ æ ¸å¿ƒéœ€æ±‚

### æ¥­å‹™ç›®æ¨™
1. **æ¨¡æ¿åŒ¯å…¥**: æ”¯æ´ Excel/Word å®šæª¢è¡¨æ ¼å¼åŒ¯å…¥
2. **å¼•å°å¡«å¯«**: App ä¾ç…§è¡¨æ ¼å…§å®¹å¼•å°ä½¿ç”¨è€…é€é …å®Œæˆ
3. **æ··åˆå¡«å¯«**: æ”¯æ´æ‰‹å‹•è¼¸å…¥ã€æ‹ç…§ AI åˆ†æè‡ªå‹•å¡«å…¥ã€ç´”æ‹ç…§é …ç›®
4. **ç”Ÿæˆå ±å‘Š**: æ•¸å€¼å¡«å›è¡¨æ ¼ï¼Œç”¢ç”Ÿå¸¶ç°½åçš„ PDF æ–‡ä»¶
5. **å¾Œç«¯æ•´åˆ**: è³‡æ–™ä¸Šå‚³è‡³å¾Œç«¯è³‡æ–™åº«ï¼Œæ”¯æ´ç›£æ§èˆ‡çµ±è¨ˆç³»çµ±æ•´åˆ
6. **é€±æœŸæé†’**: è¨­å‚™å®šæª¢é€±æœŸè‡ªå‹•æé†’

### æ ¸å¿ƒæŒ‘æˆ°èˆ‡è§£æ±ºæ–¹æ¡ˆ
| æŒ‘æˆ° | è§£æ±ºæ–¹æ¡ˆ |
|------|---------|
| Excel/Word æ ¼å¼å¤šæ¨£åŒ– | æ¡ç”¨ JSON ä¸­ä»‹æ ¼å¼ + æ¨¡æ¿ç·¨è¼¯å™¨ |
| PDF å›å¡«é›£åº¦é«˜ | ä½¿ç”¨ Placeholder æ¨¡æ¿ + PDF å¡«å……æŠ€è¡“ |
| é›¢ç·šèˆ‡ç·šä¸ŠåŒæ­¥ | æœ¬åœ°å„ªå…ˆ + èƒŒæ™¯åŒæ­¥æ©Ÿåˆ¶ |
| å½ˆæ€§èˆ‡æ¨™æº–åŒ–å¹³è¡¡ | è‡ªå®šç¾©æ¨¡æ¿ + é è¨­ç¯„æœ¬åº« |

---

## ğŸ“‹ ç³»çµ±æ¶æ§‹è¨­è¨ˆ

### æ•´é«”æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Phase 1: æ¨¡æ¿å»ºç«‹                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Excel/Word    â”€â”€åŒ¯å…¥â”€â”€>  æ¨¡æ¿ç·¨è¼¯å™¨  â”€â”€å„²å­˜â”€â”€>  JSON æ¨¡æ¿   â”‚
â”‚   å®šæª¢è¡¨                  (Web/App)               (.json)    â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Phase 2: ç¾å ´æª¢æ¸¬                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  1. é¸æ“‡æ¨¡æ¿ & è¨­å‚™                                           â”‚
â”‚  2. å¼•å°å¼å¡«å¯«                                                â”‚
â”‚     â”œâ”€ æ–‡å­—/æ•¸å€¼æ¬„ä½ï¼šæ‰‹å‹•è¼¸å…¥æˆ– AI è¾¨è­˜                      â”‚
â”‚     â”œâ”€ ç…§ç‰‡æ¬„ä½ï¼šæ‹ç…§ + AI åˆ†æè‡ªå‹•å¡«å…¥                       â”‚
â”‚     â”œâ”€ é¸é …æ¬„ä½ï¼šå–®é¸/å¤šé¸/ä¸‹æ‹‰å¼é¸å–®                         â”‚
â”‚     â””â”€ ç°½åæ¬„ä½ï¼šæ‰‹å¯«ç°½å                                     â”‚
â”‚  3. é›¢ç·šå„²å­˜ï¼ˆæœ¬åœ° SQLiteï¼‰                                   â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Phase 3: å ±å‘Šç”Ÿæˆ                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  å¡«å¯«å®Œæˆ   â”€â”€>   PDF æ¨¡æ¿    â”€â”€å¡«å……â”€â”€>   ç°½å PDF          â”‚
â”‚   è³‡æ–™            (å« Placeholder)            (.pdf)         â”‚
â”‚                                                               â”‚
â”‚  åŒæ­¥ä¸Šå‚³   â”€â”€>   å¾Œç«¯è³‡æ–™åº«  â”€â”€æ•´åˆâ”€â”€>   ç›£æ§/çµ±è¨ˆç³»çµ±      â”‚
â”‚                  (Supabase/Firebase)                         â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Phase 4: æŒçºŒç®¡ç†                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  è¨­å‚™ç®¡ç†   â”€â”€>   å®šæª¢é€±æœŸè¨­å®š  â”€â”€>   è‡ªå‹•æé†’é€šçŸ¥           â”‚
â”‚  æ­·å²æŸ¥è©¢   â”€â”€>   è¶¨å‹¢åˆ†æ      â”€â”€>   é æ¸¬æ€§ç¶­è­·             â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—‚ï¸ æ¨¡æ¿ç³»çµ±è¨­è¨ˆ

### 1. JSON æ¨¡æ¿æ ¼å¼è¦ç¯„

#### 1.1 åŸºæœ¬çµæ§‹

```json
{
  "template_id": "TEMP-2025-001",
  "template_name": "é›»æ©Ÿè¨­å‚™å®šæœŸæª¢æŸ¥è¡¨",
  "template_version": "1.0",
  "category": "é›»æ©Ÿè¨­å‚™",
  "created_at": "2025-11-04T10:00:00Z",
  "updated_at": "2025-11-04T10:00:00Z",

  "metadata": {
    "company": "å°ç£é›»åŠ›å…¬å¸",
    "department": "ç¶­è­·éƒ¨",
    "inspection_cycle_days": 30,
    "estimated_duration_minutes": 45,
    "required_tools": ["æº«åº¦è¨ˆ", "å™ªéŸ³è¨ˆ", "ç›¸æ©Ÿ"],
    "safety_notes": "æª¢æŸ¥å‰å‹™å¿…é—œé–‰é›»æº"
  },

  "sections": [
    {
      "section_id": "basic_info",
      "section_title": "åŸºæœ¬è³‡è¨Š",
      "section_order": 1,
      "fields": [...]
    },
    {
      "section_id": "inspection_items",
      "section_title": "æª¢æ¸¬é …ç›®",
      "section_order": 2,
      "fields": [...]
    },
    {
      "section_id": "conclusion",
      "section_title": "æª¢æ¸¬çµè«–",
      "section_order": 3,
      "fields": [...]
    }
  ]
}
```

#### 1.2 æ¬„ä½é¡å‹è¦ç¯„

```json
{
  "fields": [
    // é¡å‹ 1: æ–‡å­—è¼¸å…¥
    {
      "field_id": "equipment_name",
      "field_type": "text",
      "label": "è¨­å‚™åç¨±",
      "placeholder": "è«‹è¼¸å…¥è¨­å‚™åç¨±",
      "required": true,
      "ai_fillable": false,
      "max_length": 100,
      "validation": {
        "pattern": null,
        "min_length": 2
      }
    },

    // é¡å‹ 2: æ•¸å€¼è¼¸å…¥ï¼ˆæ”¯æ´ AI è¾¨è­˜ï¼‰
    {
      "field_id": "temperature",
      "field_type": "number",
      "label": "æº«åº¦è®€æ•¸",
      "unit": "Â°C",
      "required": true,
      "ai_fillable": true,
      "photo_required": true,
      "validation": {
        "min": -50,
        "max": 200,
        "decimal_places": 1
      },
      "warning_threshold": {
        "min": 20,
        "max": 80,
        "message": "æº«åº¦è¶…å‡ºæ­£å¸¸ç¯„åœï¼Œè«‹æª¢æŸ¥"
      }
    },

    // é¡å‹ 3: å–®é¸
    {
      "field_id": "operation_status",
      "field_type": "radio",
      "label": "é‹è½‰ç‹€æ…‹",
      "required": true,
      "ai_fillable": true,
      "options": [
        {"value": "normal", "label": "æ­£å¸¸"},
        {"value": "abnormal", "label": "ç•°å¸¸"},
        {"value": "stopped", "label": "åœæ©Ÿ"}
      ],
      "default_value": "normal"
    },

    // é¡å‹ 4: å¤šé¸
    {
      "field_id": "abnormal_symptoms",
      "field_type": "checkbox",
      "label": "ç•°å¸¸ç—‡ç‹€ï¼ˆå¯è¤‡é¸ï¼‰",
      "required": false,
      "ai_fillable": true,
      "options": [
        {"value": "noise", "label": "ç•°å¸¸å™ªéŸ³"},
        {"value": "vibration", "label": "éœ‡å‹•éå¤§"},
        {"value": "overheat", "label": "éç†±"},
        {"value": "leak", "label": "æ´©æ¼"},
        {"value": "other", "label": "å…¶ä»–"}
      ]
    },

    // é¡å‹ 5: ä¸‹æ‹‰å¼é¸å–®
    {
      "field_id": "equipment_type",
      "field_type": "dropdown",
      "label": "è¨­å‚™é¡å‹",
      "required": true,
      "ai_fillable": false,
      "options": [
        {"value": "motor", "label": "é¦¬é”"},
        {"value": "pump", "label": "æ³µæµ¦"},
        {"value": "valve", "label": "é–¥é–€"},
        {"value": "transformer", "label": "è®Šå£“å™¨"}
      ]
    },

    // é¡å‹ 6: æ—¥æœŸæ™‚é–“
    {
      "field_id": "inspection_date",
      "field_type": "datetime",
      "label": "æª¢æ¸¬æ—¥æœŸ",
      "required": true,
      "ai_fillable": false,
      "default_value": "now",
      "format": "YYYY-MM-DD HH:mm"
    },

    // é¡å‹ 7: ç…§ç‰‡ï¼ˆå–®å¼µï¼‰
    {
      "field_id": "equipment_photo",
      "field_type": "photo",
      "label": "è¨­å‚™å¤–è§€ç…§ç‰‡",
      "required": true,
      "ai_analyze": true,
      "max_size_mb": 10,
      "min_resolution": {"width": 800, "height": 600}
    },

    // é¡å‹ 8: ç…§ç‰‡ï¼ˆå¤šå¼µï¼‰
    {
      "field_id": "detail_photos",
      "field_type": "photo_multiple",
      "label": "ç´°ç¯€ç…§ç‰‡",
      "required": false,
      "ai_analyze": true,
      "min_count": 1,
      "max_count": 5
    },

    // é¡å‹ 9: é•·æ–‡å­—ï¼ˆå‚™è¨»ï¼‰
    {
      "field_id": "notes",
      "field_type": "textarea",
      "label": "å‚™è¨»èªªæ˜",
      "placeholder": "è«‹è©³ç´°æè¿°ç•°å¸¸æƒ…æ³...",
      "required": false,
      "ai_fillable": false,
      "max_length": 500,
      "rows": 4
    },

    // é¡å‹ 10: ç°½å
    {
      "field_id": "inspector_signature",
      "field_type": "signature",
      "label": "æª¢æ¸¬äººå“¡ç°½å",
      "required": true,
      "save_as_image": true
    },

    // é¡å‹ 11: AI è‡ªå‹•åˆ†æçµæœ
    {
      "field_id": "ai_assessment",
      "field_type": "ai_result",
      "label": "AI ç¶œåˆè©•ä¼°",
      "required": false,
      "editable": true,
      "depends_on": ["equipment_photo", "temperature", "operation_status"]
    },

    // é¡å‹ 12: æ¸¬é‡å€¼ï¼ˆæ”¯æ´ 2D æ¸¬é‡å·¥å…·ï¼‰
    {
      "field_id": "crack_size",
      "field_type": "measurement",
      "label": "è£‚ç¸«å°ºå¯¸",
      "unit": "mm",
      "required": false,
      "ai_fillable": true,
      "photo_required": true,
      "measurement_tool": "2d_ruler"
    }
  ]
}
```

#### 1.3 æ¢ä»¶é¡¯ç¤ºé‚è¼¯

```json
{
  "field_id": "abnormal_description",
  "field_type": "textarea",
  "label": "ç•°å¸¸æè¿°",
  "required": true,
  "conditional": {
    "show_when": {
      "field": "operation_status",
      "operator": "equals",
      "value": "abnormal"
    }
  }
}
```

#### 1.4 è¨ˆç®—æ¬„ä½

```json
{
  "field_id": "total_score",
  "field_type": "calculated",
  "label": "ç¸½åˆ†",
  "formula": "appearance_score + function_score + safety_score",
  "display_format": "ç¸½åˆ†ï¼š{value} / 100"
}
```

---

### 2. æ¨¡æ¿ç·¨è¼¯å™¨è¨­è¨ˆ

#### 2.1 Web æ¨¡æ¿ç·¨è¼¯å™¨ï¼ˆå„ªå…ˆé–‹ç™¼ï¼‰

**åŠŸèƒ½éœ€æ±‚**:
- âœ… Excel/Word æª”æ¡ˆä¸Šå‚³èˆ‡è§£æ
- âœ… è¦–è¦ºåŒ–æ‹–æ”¾å¼æ¬„ä½ç·¨è¼¯
- âœ… æ¬„ä½é¡å‹é¸æ“‡èˆ‡å±¬æ€§è¨­å®š
- âœ… å³æ™‚é è¦½ï¼ˆæ‰‹æ©Ÿè¦–åœ–ï¼‰
- âœ… JSON åŒ¯å‡ºèˆ‡åŒ¯å…¥
- âœ… ç‰ˆæœ¬ç®¡ç†èˆ‡æ­·å²è¨˜éŒ„

**æŠ€è¡“æ–¹æ¡ˆ**:
- å‰ç«¯: React.js + TypeScript
- Excel è§£æ: `xlsx` (SheetJS)
- Word è§£æ: `mammoth.js` æˆ– `docx` (åƒ…æ”¯æ´ .docx)
- æ‹–æ”¾: `react-beautiful-dnd` æˆ– `dnd-kit`
- è¡¨å–®é©—è­‰: `zod` + `react-hook-form`

**å·¥ä½œæµç¨‹**:
```
1. ä¸Šå‚³ Excel/Word
   â†“
2. AI è¼”åŠ©è§£æè¡¨æ ¼çµæ§‹ï¼ˆGeminiï¼‰
   - è­˜åˆ¥æ¬„ä½åç¨±
   - æ¨æ¸¬æ¬„ä½é¡å‹
   - å»ºè­°å¿…å¡«å±¬æ€§
   â†“
3. ä½¿ç”¨è€…æ‰‹å‹•èª¿æ•´
   - æ‹–æ”¾æ’åº
   - è¨­å®šå±¬æ€§
   - æ·»åŠ é©—è­‰è¦å‰‡
   â†“
4. ç”¢ç”Ÿ JSON æ¨¡æ¿
   â†“
5. åŒ¯å‡ºæˆ–ç›´æ¥ä¸Šå‚³è‡³ App
```

#### 2.2 App å…§ç°¡æ˜“ç·¨è¼¯å™¨ï¼ˆæ¬¡è¦ï¼‰

**åŠŸèƒ½éœ€æ±‚**:
- âœ… è¤‡è£½ç¾æœ‰æ¨¡æ¿
- âœ… ä¿®æ”¹æ¬„ä½æ¨™ç±¤èˆ‡é †åº
- âœ… èª¿æ•´å¿…å¡«å±¬æ€§
- âŒ ä¸æ”¯æ´è¤‡é›œçš„çµæ§‹è®Šæ›´

---

### 3. æ¨¡æ¿å„²å­˜èˆ‡ç®¡ç†

#### 3.1 æœ¬åœ°å„²å­˜ï¼ˆSQLiteï¼‰

**è³‡æ–™è¡¨: templates**
```sql
CREATE TABLE templates (
  id TEXT PRIMARY KEY,
  name TEXT NOT NULL,
  category TEXT,
  version TEXT,
  json_content TEXT NOT NULL,  -- JSON æ¨¡æ¿å®Œæ•´å…§å®¹
  created_at INTEGER NOT NULL,
  updated_at INTEGER NOT NULL,
  is_default BOOLEAN DEFAULT 0,
  usage_count INTEGER DEFAULT 0
);
```

**è³‡æ–™è¡¨: template_records**
```sql
CREATE TABLE template_records (
  id TEXT PRIMARY KEY,
  template_id TEXT NOT NULL,
  equipment_id TEXT,
  equipment_name TEXT,
  filled_data TEXT NOT NULL,  -- JSON æ ¼å¼å¡«å¯«è³‡æ–™
  status TEXT CHECK(status IN ('draft', 'completed', 'submitted')),
  created_at INTEGER NOT NULL,
  completed_at INTEGER,
  synced_to_backend BOOLEAN DEFAULT 0,
  pdf_path TEXT,
  FOREIGN KEY (template_id) REFERENCES templates(id),
  FOREIGN KEY (equipment_id) REFERENCES equipments(id)
);
```

#### 3.2 é›²ç«¯åŒæ­¥

**Supabase è³‡æ–™è¡¨è¨­è¨ˆ**:

```sql
-- æ¨¡æ¿è¡¨
CREATE TABLE public.templates (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  organization_id UUID REFERENCES public.organizations(id),
  name TEXT NOT NULL,
  category TEXT,
  version TEXT,
  json_content JSONB NOT NULL,
  created_by UUID REFERENCES auth.users(id),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  is_active BOOLEAN DEFAULT true
);

-- æª¢æ¸¬è¨˜éŒ„è¡¨
CREATE TABLE public.inspection_records (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  template_id UUID REFERENCES public.templates(id),
  equipment_id UUID REFERENCES public.equipments(id),
  inspector_id UUID REFERENCES auth.users(id),
  filled_data JSONB NOT NULL,
  status TEXT CHECK(status IN ('draft', 'completed', 'approved', 'rejected')),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  completed_at TIMESTAMPTZ,
  approved_at TIMESTAMPTZ,
  approved_by UUID REFERENCES auth.users(id),
  pdf_url TEXT,
  photos JSONB,  -- ç…§ç‰‡ URL é™£åˆ—
  CONSTRAINT valid_status CHECK (
    status = 'draft' OR completed_at IS NOT NULL
  )
);

-- è¨­å‚™è¡¨
CREATE TABLE public.equipments (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  organization_id UUID REFERENCES public.organizations(id),
  equipment_code TEXT UNIQUE NOT NULL,
  equipment_name TEXT NOT NULL,
  equipment_type TEXT,
  location TEXT,
  qr_code TEXT,
  inspection_cycle_days INTEGER DEFAULT 30,
  last_inspection_date DATE,
  next_inspection_date DATE,
  status TEXT DEFAULT 'active',
  metadata JSONB,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- å®šæª¢æé†’è¡¨
CREATE TABLE public.inspection_reminders (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  equipment_id UUID REFERENCES public.equipments(id),
  template_id UUID REFERENCES public.templates(id),
  due_date DATE NOT NULL,
  reminder_sent BOOLEAN DEFAULT false,
  completed BOOLEAN DEFAULT false,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## ğŸ“„ PDF ç”Ÿæˆèˆ‡å›å¡«ç­–ç•¥

### æ–¹æ¡ˆ Aï¼šHTML æ¨¡æ¿è½‰ PDFï¼ˆæ¨è–¦ï¼‰

**å„ªé»**:
- âœ… è¨­è¨ˆå½ˆæ€§é«˜ï¼ˆCSS æ¨£å¼ï¼‰
- âœ… æ˜“æ–¼ç¶­è­·èˆ‡èª¿æ•´ç‰ˆå‹
- âœ… æ”¯æ´ä¸­æ–‡å­—å‹
- âœ… å¯åµŒå…¥ç…§ç‰‡èˆ‡ç°½å

**ç¼ºé»**:
- âŒ ä¸æ˜¯ã€Œå¡«å›åŸè¡¨æ ¼ã€ï¼Œè€Œæ˜¯é‡æ–°ç”Ÿæˆ

**æŠ€è¡“å¯¦ä½œ**:

```dart
// ä½¿ç”¨ printing package
import 'package:printing/printing.dart';
import 'package:pdf/pdf.dart';
import 'package:pdf/widgets.dart' as pw;

Future<Uint8List> generateInspectionPDF({
  required String templateName,
  required Map<String, dynamic> filledData,
  required Uint8List? signatureImage,
}) async {
  final pdf = pw.Document();

  // è¼‰å…¥ä¸­æ–‡å­—å‹
  final font = await PdfGoogleFonts.notoSansRegular();
  final fontBold = await PdfGoogleFonts.notoSansBold();

  pdf.addPage(
    pw.MultiPage(
      pageFormat: PdfPageFormat.a4,
      theme: pw.ThemeData.withFont(
        base: font,
        bold: fontBold,
      ),
      build: (pw.Context context) => [
        // æ¨™é¡Œ
        pw.Header(
          level: 0,
          child: pw.Text(templateName, style: pw.TextStyle(fontSize: 24)),
        ),

        // åŸºæœ¬è³‡è¨Šå€å¡Š
        _buildInfoSection(filledData),

        // æª¢æ¸¬é …ç›®è¡¨æ ¼
        _buildInspectionTable(filledData),

        // ç…§ç‰‡å€å¡Š
        if (filledData['photos'] != null)
          _buildPhotoSection(filledData['photos']),

        // ç°½åå€å¡Š
        if (signatureImage != null)
          _buildSignatureSection(signatureImage),

        // é å°¾
        pw.Footer(
          child: pw.Text('å ±å‘Šç”¢ç”Ÿæ™‚é–“ï¼š${DateTime.now()}'),
        ),
      ],
    ),
  );

  return pdf.save();
}
```

**HTML æ¨¡æ¿ç¯„ä¾‹**:
```html
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    @page { size: A4; margin: 2cm; }
    body { font-family: 'Noto Sans TC', sans-serif; }
    .header { text-align: center; border-bottom: 2px solid #333; }
    .field { margin: 10px 0; }
    .field-label { font-weight: bold; display: inline-block; width: 150px; }
    .field-value { display: inline-block; border-bottom: 1px solid #999; }
    .photo-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
    .signature { margin-top: 50px; text-align: right; }
  </style>
</head>
<body>
  <div class="header">
    <h1>{{template_name}}</h1>
    <p>è¨­å‚™åç¨±ï¼š{{equipment_name}}</p>
  </div>

  <div class="content">
    {{#sections}}
    <h2>{{section_title}}</h2>
    {{#fields}}
    <div class="field">
      <span class="field-label">{{label}}ï¼š</span>
      <span class="field-value">{{value}} {{unit}}</span>
    </div>
    {{/fields}}
    {{/sections}}
  </div>

  <div class="photo-grid">
    {{#photos}}
    <img src="{{url}}" alt="{{description}}" />
    {{/photos}}
  </div>

  <div class="signature">
    <p>æª¢æ¸¬äººå“¡ç°½åï¼š</p>
    <img src="{{signature}}" alt="ç°½å" />
    <p>æ—¥æœŸï¼š{{date}}</p>
  </div>
</body>
</html>
```

---

### æ–¹æ¡ˆ Bï¼šPDF æ¨¡æ¿å¡«å……ï¼ˆé©ç”¨æ–¼å›ºå®šæ ¼å¼ï¼‰

**é©ç”¨å ´æ™¯**:
- å®¢æˆ¶æä¾›æ¨™æº– PDF è¡¨æ ¼
- éœ€è¦å®Œå…¨ç¬¦åˆæ—¢æœ‰æ ¼å¼

**æŠ€è¡“å¯¦ä½œ**:
ä½¿ç”¨ `syncfusion_flutter_pdf` æˆ–é¡ä¼¼å¥—ä»¶

```dart
import 'package:syncfusion_flutter_pdf/pdf.dart';

Future<Uint8List> fillPDFTemplate({
  required String templatePath,
  required Map<String, dynamic> data,
}) async {
  // è¼‰å…¥ PDF æ¨¡æ¿
  final PdfDocument document = PdfDocument(
    inputBytes: await File(templatePath).readAsBytes(),
  );

  // å–å¾—è¡¨å–®æ¬„ä½
  final PdfForm form = document.form;

  // å¡«å……æ¬„ä½
  data.forEach((key, value) {
    final field = form.fields.firstWhere(
      (field) => field.name == key,
      orElse: () => null,
    );

    if (field != null) {
      if (field is PdfTextBoxField) {
        field.text = value.toString();
      } else if (field is PdfCheckBoxField) {
        field.isChecked = value as bool;
      }
    }
  });

  // æ‰å¹³åŒ–è¡¨å–®ï¼ˆé˜²æ­¢ä¿®æ”¹ï¼‰
  form.flattenAllFields();

  // å„²å­˜
  final bytes = await document.save();
  document.dispose();

  return bytes;
}
```

**æº–å‚™ PDF æ¨¡æ¿æ­¥é©Ÿ**:
1. ä½¿ç”¨ Adobe Acrobat æˆ– PDFtk å»ºç«‹è¡¨å–®æ¬„ä½
2. ç‚ºæ¯å€‹æ¬„ä½è¨­å®šåç¨±ï¼ˆèˆ‡ JSON `field_id` å°æ‡‰ï¼‰
3. è¨­å®šæ¬„ä½é¡å‹ï¼ˆæ–‡å­—æ¡†ã€æ ¸å–æ–¹å¡Šç­‰ï¼‰
4. åŒ¯å‡ºç‚º PDF æ¨¡æ¿

---

### æ–¹æ¡ˆ Cï¼šPlaceholder æ–‡å­—æ›¿æ›ï¼ˆæœ€ç°¡å–®ï¼‰

**é©ç”¨å ´æ™¯**:
- å¿«é€ŸåŸå‹
- ç°¡å–®è¡¨æ ¼

**å¯¦ä½œæ–¹å¼**:
```dart
String generatePDFContent(Map<String, dynamic> data) {
  String template = '''
è¨­å‚™åç¨±ï¼š{{equipment_name}}
æª¢æ¸¬æ—¥æœŸï¼š{{inspection_date}}
æº«åº¦ï¼š{{temperature}} Â°C
ç‹€æ…‹ï¼š{{status}}
  ''';

  data.forEach((key, value) {
    template = template.replaceAll('{{$key}}', value.toString());
  });

  return template;
}
```

---

## ğŸ”— å¾Œç«¯æ•´åˆæ–¹æ¡ˆ

### 1. API è¨­è¨ˆ

#### 1.1 RESTful API ç«¯é»

**æ¨¡æ¿ç®¡ç†**
```
GET    /api/templates              # å–å¾—æ¨¡æ¿åˆ—è¡¨
GET    /api/templates/:id          # å–å¾—ç‰¹å®šæ¨¡æ¿
POST   /api/templates              # å»ºç«‹æ–°æ¨¡æ¿
PUT    /api/templates/:id          # æ›´æ–°æ¨¡æ¿
DELETE /api/templates/:id          # åˆªé™¤æ¨¡æ¿
```

**æª¢æ¸¬è¨˜éŒ„**
```
GET    /api/inspections            # å–å¾—æª¢æ¸¬è¨˜éŒ„åˆ—è¡¨
GET    /api/inspections/:id        # å–å¾—ç‰¹å®šè¨˜éŒ„
POST   /api/inspections            # å»ºç«‹æª¢æ¸¬è¨˜éŒ„
PUT    /api/inspections/:id        # æ›´æ–°è¨˜éŒ„
POST   /api/inspections/:id/submit # æäº¤è¨˜éŒ„ï¼ˆè®Šæ›´ç‹€æ…‹ï¼‰
POST   /api/inspections/:id/pdf    # ç”Ÿæˆ PDF
```

**è¨­å‚™ç®¡ç†**
```
GET    /api/equipments             # å–å¾—è¨­å‚™åˆ—è¡¨
GET    /api/equipments/:id         # å–å¾—è¨­å‚™è©³æƒ…
POST   /api/equipments             # æ–°å¢è¨­å‚™
PUT    /api/equipments/:id         # æ›´æ–°è¨­å‚™
GET    /api/equipments/:id/history # å–å¾—è¨­å‚™æª¢æ¸¬æ­·å²
```

**æé†’ç³»çµ±**
```
GET    /api/reminders              # å–å¾—å¾…æª¢æ¸¬æé†’
POST   /api/reminders              # å»ºç«‹æé†’
PUT    /api/reminders/:id/complete # å®Œæˆæé†’
```

#### 1.2 è«‹æ±‚/å›æ‡‰æ ¼å¼ç¯„ä¾‹

**POST /api/inspections**
```json
{
  "template_id": "uuid",
  "equipment_id": "uuid",
  "filled_data": {
    "equipment_name": "å†·å»æ³µæµ¦ A1",
    "temperature": 65.5,
    "operation_status": "normal",
    "photos": [
      {
        "field_id": "equipment_photo",
        "file_name": "photo_001.jpg",
        "file_size": 2048576,
        "uploaded": true,
        "url": "https://storage.example.com/photos/..."
      }
    ]
  },
  "status": "draft"
}
```

**Response 200 OK**
```json
{
  "id": "uuid",
  "created_at": "2025-11-04T10:30:00Z",
  "status": "draft",
  "sync_status": "synced"
}
```

---

### 2. åŒæ­¥æ©Ÿåˆ¶

#### 2.1 é›¢ç·šå„ªå…ˆç­–ç•¥

```dart
class SyncService {
  // å»ºç«‹æª¢æ¸¬è¨˜éŒ„ï¼ˆé›¢ç·šå„ªå…ˆï¼‰
  Future<String> createInspectionRecord(InspectionRecord record) async {
    // 1. å…ˆå„²å­˜åˆ°æœ¬åœ° SQLite
    await _localDB.insert(record);

    // 2. æ¨™è¨˜ç‚ºå¾…åŒæ­¥
    await _localDB.markForSync(record.id);

    // 3. å¦‚æœæœ‰ç¶²è·¯ï¼Œç«‹å³ä¸Šå‚³
    if (await _networkService.isOnline()) {
      await _uploadToBackend(record);
    } else {
      // 4. ç„¡ç¶²è·¯æ™‚åŠ å…¥èƒŒæ™¯åŒæ­¥ä½‡åˆ—
      await _backgroundSyncQueue.add(record.id);
    }

    return record.id;
  }

  // èƒŒæ™¯åŒæ­¥ï¼ˆå®šæœŸåŸ·è¡Œï¼‰
  Future<void> syncPendingRecords() async {
    final pendingRecords = await _localDB.getPendingSync();

    for (final record in pendingRecords) {
      try {
        await _uploadToBackend(record);
        await _localDB.markSynced(record.id);
      } catch (e) {
        print('Sync failed for ${record.id}: $e');
        // ä¿ç•™åœ¨ä½‡åˆ—ä¸­ï¼Œä¸‹æ¬¡é‡è©¦
      }
    }
  }

  // ä¸Šå‚³åˆ°å¾Œç«¯
  Future<void> _uploadToBackend(InspectionRecord record) async {
    // 1. å…ˆä¸Šå‚³ç…§ç‰‡åˆ° Storage
    for (final photo in record.photos) {
      if (!photo.uploaded) {
        final url = await _uploadPhoto(photo.localPath);
        photo.url = url;
        photo.uploaded = true;
      }
    }

    // 2. ä¸Šå‚³æª¢æ¸¬è¨˜éŒ„åˆ°è³‡æ–™åº«
    await _apiClient.post('/api/inspections', body: record.toJson());
  }
}
```

#### 2.2 è¡çªè§£æ±ºç­–ç•¥

```dart
enum ConflictResolution {
  serverWins,    // ä¼ºæœå™¨ç‰ˆæœ¬å„ªå…ˆ
  clientWins,    // å®¢æˆ¶ç«¯ç‰ˆæœ¬å„ªå…ˆ
  manual,        // æ‰‹å‹•é¸æ“‡
  merge,         // åˆä½µï¼ˆè‹¥å¯èƒ½ï¼‰
}

class ConflictResolver {
  Future<InspectionRecord> resolve({
    required InspectionRecord localRecord,
    required InspectionRecord serverRecord,
    ConflictResolution strategy = ConflictResolution.serverWins,
  }) async {
    switch (strategy) {
      case ConflictResolution.serverWins:
        return serverRecord;

      case ConflictResolution.clientWins:
        return localRecord;

      case ConflictResolution.manual:
        return await _showConflictDialog(localRecord, serverRecord);

      case ConflictResolution.merge:
        return _mergeRecords(localRecord, serverRecord);
    }
  }
}
```

---

### 3. ç›£æ§èˆ‡çµ±è¨ˆæ•´åˆ

#### 3.1 å³æ™‚ç›£æ§å„€è¡¨æ¿ï¼ˆWebï¼‰

**è³‡æ–™ä¾†æº**: Supabase Real-time Subscriptions

```typescript
// å³æ™‚ç›£è½æª¢æ¸¬è¨˜éŒ„æ›´æ–°
const subscription = supabase
  .channel('inspection-records')
  .on('postgres_changes', {
    event: 'INSERT',
    schema: 'public',
    table: 'inspection_records'
  }, (payload) => {
    console.log('New inspection:', payload.new);
    updateDashboard(payload.new);
  })
  .subscribe();

// çµ±è¨ˆè³‡æ–™æŸ¥è©¢
async function getDashboardStats(organizationId: string) {
  const { data, error } = await supabase.rpc('get_dashboard_stats', {
    org_id: organizationId,
    date_from: '2025-01-01',
    date_to: '2025-12-31'
  });

  return {
    totalInspections: data.total_inspections,
    abnormalRate: data.abnormal_rate,
    avgCompletionTime: data.avg_completion_time,
    topAbnormalEquipments: data.top_abnormal_equipments
  };
}
```

#### 3.2 PostgreSQL çµ±è¨ˆå‡½æ•¸

```sql
-- å»ºç«‹çµ±è¨ˆå‡½æ•¸
CREATE OR REPLACE FUNCTION get_dashboard_stats(
  org_id UUID,
  date_from DATE,
  date_to DATE
)
RETURNS JSON AS $$
DECLARE
  result JSON;
BEGIN
  SELECT json_build_object(
    'total_inspections', COUNT(*),
    'abnormal_rate',
      ROUND(
        COUNT(*) FILTER (WHERE (filled_data->>'operation_status') = 'abnormal')::NUMERIC /
        COUNT(*)::NUMERIC * 100,
        2
      ),
    'avg_completion_time',
      AVG(EXTRACT(EPOCH FROM (completed_at - created_at)) / 60),
    'top_abnormal_equipments',
      (
        SELECT json_agg(row_to_json(t))
        FROM (
          SELECT
            e.equipment_name,
            COUNT(*) as abnormal_count
          FROM inspection_records ir
          JOIN equipments e ON ir.equipment_id = e.id
          WHERE
            ir.organization_id = org_id
            AND (ir.filled_data->>'operation_status') = 'abnormal'
            AND ir.created_at BETWEEN date_from AND date_to
          GROUP BY e.equipment_name
          ORDER BY abnormal_count DESC
          LIMIT 10
        ) t
      )
  ) INTO result
  FROM inspection_records
  WHERE
    organization_id = org_id
    AND created_at BETWEEN date_from AND date_to;

  RETURN result;
END;
$$ LANGUAGE plpgsql;
```

---

## â° å®šæª¢é€±æœŸæé†’ç³»çµ±

### 1. æé†’é‚è¼¯è¨­è¨ˆ

```dart
class ReminderService {
  // è¨ˆç®—ä¸‹æ¬¡æª¢æ¸¬æ—¥æœŸ
  DateTime calculateNextInspectionDate({
    required DateTime lastInspectionDate,
    required int cycleDays,
  }) {
    return lastInspectionDate.add(Duration(days: cycleDays));
  }

  // å»ºç«‹æé†’
  Future<void> createReminder({
    required Equipment equipment,
  }) async {
    final nextDate = calculateNextInspectionDate(
      lastInspectionDate: equipment.lastInspectionDate,
      cycleDays: equipment.inspectionCycleDays,
    );

    final reminder = InspectionReminder(
      equipmentId: equipment.id,
      templateId: equipment.defaultTemplateId,
      dueDate: nextDate,
    );

    // å„²å­˜åˆ°æœ¬åœ°
    await _localDB.insertReminder(reminder);

    // åŒæ­¥åˆ°å¾Œç«¯
    await _apiClient.post('/api/reminders', body: reminder.toJson());

    // æ’ç¨‹æœ¬åœ°é€šçŸ¥
    await _scheduleNotification(reminder);
  }

  // æ’ç¨‹æœ¬åœ°é€šçŸ¥
  Future<void> _scheduleNotification(InspectionReminder reminder) async {
    final equipment = await _getEquipment(reminder.equipmentId);

    // æå‰ 3 å¤©æé†’
    final notificationDate = reminder.dueDate.subtract(Duration(days: 3));

    await FlutterLocalNotificationsPlugin().zonedSchedule(
      reminder.id.hashCode,
      'å®šæœŸæª¢æ¸¬æé†’',
      'è¨­å‚™ã€Œ${equipment.name}ã€éœ€è¦é€²è¡Œå®šæœŸæª¢æ¸¬',
      tz.TZDateTime.from(notificationDate, tz.local),
      const NotificationDetails(
        android: AndroidNotificationDetails(
          'inspection_reminder',
          'å®šæª¢æé†’',
          channelDescription: 'è¨­å‚™å®šæœŸæª¢æ¸¬æé†’',
          importance: Importance.high,
        ),
      ),
      androidAllowWhileIdle: true,
      uiLocalNotificationDateInterpretation:
          UILocalNotificationDateInterpretation.absoluteTime,
    );
  }

  // æ¯æ—¥æª¢æŸ¥é€¾æœŸæé†’
  Future<void> checkOverdueReminders() async {
    final overdueReminders = await _localDB.getOverdueReminders();

    for (final reminder in overdueReminders) {
      await _sendOverdueNotification(reminder);
    }
  }
}
```

### 2. å¾Œç«¯å®šæ™‚ä»»å‹™ï¼ˆSupabase Edge Functionsï¼‰

```typescript
// supabase/functions/check-reminders/index.ts
import { serve } from "https://deno.land/std@0.168.0/http/server.ts"
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

serve(async (req) => {
  const supabase = createClient(
    Deno.env.get('SUPABASE_URL') ?? '',
    Deno.env.get('SUPABASE_SERVICE_ROLE_KEY') ?? ''
  )

  // æŸ¥è©¢å³å°‡åˆ°æœŸçš„æé†’ï¼ˆ3 å¤©å…§ï¼‰
  const { data: reminders, error } = await supabase
    .from('inspection_reminders')
    .select(`
      *,
      equipments(*),
      templates(*)
    `)
    .eq('completed', false)
    .eq('reminder_sent', false)
    .lte('due_date', new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString())

  if (error) throw error

  // ç™¼é€æ¨é€é€šçŸ¥çµ¦ç›¸é—œäººå“¡
  for (const reminder of reminders) {
    await sendPushNotification({
      userId: reminder.equipments.responsible_person_id,
      title: 'å®šæœŸæª¢æ¸¬æé†’',
      body: `è¨­å‚™ã€Œ${reminder.equipments.equipment_name}ã€éœ€è¦é€²è¡Œå®šæœŸæª¢æ¸¬`,
      data: {
        type: 'inspection_reminder',
        equipmentId: reminder.equipment_id,
        templateId: reminder.template_id
      }
    })

    // æ›´æ–°æé†’ç‹€æ…‹
    await supabase
      .from('inspection_reminders')
      .update({ reminder_sent: true })
      .eq('id', reminder.id)
  }

  return new Response(
    JSON.stringify({ success: true, reminders_sent: reminders.length }),
    { headers: { "Content-Type": "application/json" } }
  )
})
```

**è¨­å®š Cron Job**:
```sql
-- ä½¿ç”¨ pg_cron æ“´å……
CREATE EXTENSION IF NOT EXISTS pg_cron;

-- æ¯æ—¥ 08:00 åŸ·è¡Œæª¢æŸ¥
SELECT cron.schedule(
  'check-inspection-reminders',
  '0 8 * * *',
  $$
  SELECT
    net.http_post(
      url:='https://your-project.supabase.co/functions/v1/check-reminders',
      headers:='{"Content-Type": "application/json", "Authorization": "Bearer YOUR_ANON_KEY"}'::jsonb
    ) as request_id;
  $$
);
```

---

## ğŸ“± App å¯¦ä½œé‡é»

### 1. å¼•å°å¼å¡«å¯« UI

```dart
class TemplateBasedInspectionScreen extends StatefulWidget {
  final InspectionTemplate template;
  final Equipment? equipment;

  @override
  _TemplateBasedInspectionScreenState createState() =>
      _TemplateBasedInspectionScreenState();
}

class _TemplateBasedInspectionScreenState
    extends State<TemplateBasedInspectionScreen> {

  int _currentSectionIndex = 0;
  int _currentFieldIndex = 0;
  Map<String, dynamic> _filledData = {};

  @override
  Widget build(BuildContext context) {
    final currentSection = widget.template.sections[_currentSectionIndex];
    final currentField = currentSection.fields[_currentFieldIndex];

    return Scaffold(
      appBar: AppBar(
        title: Text(widget.template.name),
        subtitle: Text(
          '${currentSection.title} (${_currentFieldIndex + 1}/${currentSection.fields.length})'
        ),
      ),
      body: Column(
        children: [
          // é€²åº¦æ¢
          LinearProgressIndicator(
            value: _getProgress(),
          ),

          // æ¬„ä½è¼¸å…¥å€
          Expanded(
            child: _buildFieldInput(currentField),
          ),

          // å°èˆªæŒ‰éˆ•
          Row(
            children: [
              if (_hasPrevious())
                ElevatedButton(
                  onPressed: _goToPrevious,
                  child: Text('ä¸Šä¸€é …'),
                ),
              Spacer(),
              ElevatedButton(
                onPressed: _hasNext() ? _goToNext : _complete,
                child: Text(_hasNext() ? 'ä¸‹ä¸€é …' : 'å®Œæˆ'),
              ),
            ],
          ),
        ],
      ),
    );
  }

  Widget _buildFieldInput(TemplateField field) {
    switch (field.fieldType) {
      case FieldType.text:
        return _buildTextInput(field);
      case FieldType.number:
        return _buildNumberInput(field);
      case FieldType.photo:
        return _buildPhotoInput(field);
      case FieldType.signature:
        return _buildSignatureInput(field);
      case FieldType.radio:
        return _buildRadioInput(field);
      // ... å…¶ä»–é¡å‹
      default:
        return Text('æœªæ”¯æ´çš„æ¬„ä½é¡å‹');
    }
  }

  Widget _buildPhotoInput(TemplateField field) {
    return Column(
      children: [
        Text(field.label, style: TextStyle(fontSize: 20)),
        SizedBox(height: 20),

        // ç…§ç‰‡é è¦½
        if (_filledData[field.fieldId] != null)
          Image.file(File(_filledData[field.fieldId]['path'])),

        // æ‹ç…§æŒ‰éˆ•
        ElevatedButton.icon(
          icon: Icon(Icons.camera_alt),
          label: Text('æ‹æ”ç…§ç‰‡'),
          onPressed: () async {
            final photo = await _takePhoto();
            if (photo != null) {
              // AI åˆ†æ
              if (field.aiAnalyze) {
                final analysis = await _analyzePhoto(photo, field);
                _fillAIResults(analysis);
              }

              setState(() {
                _filledData[field.fieldId] = {
                  'path': photo.path,
                  'timestamp': DateTime.now().toIso8601String(),
                };
              });
            }
          },
        ),

        // AI åˆ†æçµæœ
        if (field.aiAnalyze && _filledData.containsKey('${field.fieldId}_ai'))
          Card(
            child: Padding(
              padding: EdgeInsets.all(16),
              child: Column(
                children: [
                  Text('AI åˆ†æçµæœ'),
                  ..._buildAIResults(_filledData['${field.fieldId}_ai']),
                ],
              ),
            ),
          ),
      ],
    );
  }
}
```

---

## ğŸ“… å¯¦æ–½è¨ˆç•«

### Phase 1: åŸºç¤æ¶æ§‹ï¼ˆ2 é€±ï¼‰

**Week 1**:
- âœ… è¨­è¨ˆ JSON æ¨¡æ¿æ ¼å¼è¦ç¯„
- âœ… å»ºç«‹æœ¬åœ°è³‡æ–™åº« Schemaï¼ˆSQLiteï¼‰
- âœ… å¯¦ä½œæ¨¡æ¿ Model èˆ‡è§£æé‚è¼¯
- âœ… å»ºç«‹ç°¡æ˜“æ¨¡æ¿ç¯„ä¾‹ï¼ˆ2-3 å€‹ï¼‰

**Week 2**:
- âœ… å¯¦ä½œå¼•å°å¼å¡«å¯« UI æ¡†æ¶
- âœ… æ”¯æ´åŸºæœ¬æ¬„ä½é¡å‹ï¼ˆtext, number, photo, signatureï¼‰
- âœ… æ•´åˆç¾æœ‰ AI åˆ†æåŠŸèƒ½
- âœ… æœ¬åœ°å„²å­˜æª¢æ¸¬è¨˜éŒ„

---

### Phase 2: æ¨¡æ¿ç·¨è¼¯å™¨ï¼ˆ2 é€±ï¼‰

**Week 3**:
- âœ… å»ºç«‹ Web æ¨¡æ¿ç·¨è¼¯å™¨å°ˆæ¡ˆï¼ˆReactï¼‰
- âœ… Excel æª”æ¡ˆä¸Šå‚³èˆ‡è§£æ
- âœ… AI è¼”åŠ©æ¬„ä½è­˜åˆ¥ï¼ˆGeminiï¼‰
- âœ… è¦–è¦ºåŒ–æ‹–æ”¾å¼ç·¨è¼¯ä»‹é¢

**Week 4**:
- âœ… æ¬„ä½å±¬æ€§è¨­å®šé¢æ¿
- âœ… å³æ™‚é è¦½åŠŸèƒ½
- âœ… JSON åŒ¯å‡ºèˆ‡é©—è­‰
- âœ… æ¨¡æ¿åˆ†äº«èˆ‡åŒ¯å…¥

---

### Phase 3: PDF ç”Ÿæˆï¼ˆ1 é€±ï¼‰

**Week 5**:
- âœ… é¸å®š PDF ç”Ÿæˆæ–¹æ¡ˆï¼ˆæ¨è–¦ HTML â†’ PDFï¼‰
- âœ… è¨­è¨ˆ PDF æ¨¡æ¿æ¨£å¼ï¼ˆ2-3 ç¨®ç‰ˆå‹ï¼‰
- âœ… å¯¦ä½œ PDF ç”Ÿæˆé‚è¼¯
- âœ… åµŒå…¥ç…§ç‰‡èˆ‡ç°½å
- âœ… æ”¯æ´ä¸­æ–‡å­—å‹
- âœ… æ¸¬è©¦èˆ‡å„ªåŒ–

---

### Phase 4: å¾Œç«¯æ•´åˆï¼ˆ2 é€±ï¼‰

**Week 6**:
- âœ… Supabase å°ˆæ¡ˆè¨­å®š
- âœ… å»ºç«‹è³‡æ–™åº« Schema
- âœ… å¯¦ä½œ API ç«¯é»ï¼ˆæ¨¡æ¿ã€è¨˜éŒ„ã€è¨­å‚™ï¼‰
- âœ… Storage è¨­å®šï¼ˆç…§ç‰‡èˆ‡ PDF å„²å­˜ï¼‰

**Week 7**:
- âœ… App ç«¯åŒæ­¥é‚è¼¯å¯¦ä½œ
- âœ… é›¢ç·šå„ªå…ˆæ©Ÿåˆ¶
- âœ… è¡çªè§£æ±ºç­–ç•¥
- âœ… èƒŒæ™¯åŒæ­¥æœå‹™

---

### Phase 5: æé†’ç³»çµ±ï¼ˆ1 é€±ï¼‰

**Week 8**:
- âœ… è¨­å‚™ç®¡ç†åŠŸèƒ½
- âœ… å®šæª¢é€±æœŸè¨­å®š
- âœ… æœ¬åœ°é€šçŸ¥æ’ç¨‹
- âœ… å¾Œç«¯å®šæ™‚ä»»å‹™ï¼ˆEdge Functionsï¼‰
- âœ… æ¨é€é€šçŸ¥æ•´åˆ

---

### Phase 6: æ¸¬è©¦èˆ‡å„ªåŒ–ï¼ˆ1 é€±ï¼‰

**Week 9**:
- âœ… æ•´åˆæ¸¬è©¦
- âœ… æ•ˆèƒ½å„ªåŒ–
- âœ… UI/UX èª¿æ•´
- âœ… æ–‡æª”æ’°å¯«
- âœ… ç™¼å¸ƒ Beta ç‰ˆæœ¬

---

## ğŸ¯ æˆåŠŸæŒ‡æ¨™

### åŠŸèƒ½å®Œæ•´æ€§
- âœ… æ”¯æ´ 5 ç¨®ä»¥ä¸Šæ¬„ä½é¡å‹
- âœ… Excel/Word åŒ¯å…¥æˆåŠŸç‡ > 90%
- âœ… PDF ç”ŸæˆæˆåŠŸç‡ 100%
- âœ… é›¢ç·š/ç·šä¸Šç„¡ç¸«åˆ‡æ›

### æ•ˆèƒ½æŒ‡æ¨™
- âœ… å–®æ¬¡æª¢æ¸¬å®Œæˆæ™‚é–“ < 10 åˆ†é˜ï¼ˆå«æ‹ç…§ï¼‰
- âœ… PDF ç”Ÿæˆæ™‚é–“ < 5 ç§’
- âœ… ç…§ç‰‡ä¸Šå‚³æ™‚é–“ < 10 ç§’/å¼µï¼ˆWi-Fiï¼‰
- âœ… App å•Ÿå‹•æ™‚é–“ < 3 ç§’

### ç”¨æˆ¶é«”é©—
- âœ… æ“ä½œç›´è¦ºï¼Œç„¡éœ€è¨“ç·´å³å¯ä¸Šæ‰‹
- âœ… AI è¼”åŠ©å¡«å¯«æº–ç¢ºç‡ > 85%
- âœ… æé†’é€šçŸ¥åŠæ™‚é€é”ç‡ > 95%
- âœ… è³‡æ–™ä¸éºå¤±ç‡ 100%

---

## ğŸ“ è¯çµ¡èˆ‡æ”¯æ´

**å°ˆæ¡ˆè² è²¬äºº**: dofliu
**é–‹ç™¼åœ˜éšŠ**: doflab åŠ‰ç‘å¼˜è€å¸«ç ”ç©¶åœ˜éšŠ
**GitHub**: https://github.com/dofliu/InduSpect

---

*æœ¬è¦æ ¼æ›¸å°‡éš¨å°ˆæ¡ˆé€²å±•æŒçºŒæ›´æ–°*
